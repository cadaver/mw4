EASY_DMGMOD      = 6                           ;8 = 100% damage
MEDIUM_DMGMOD    = 8
HARD_DMGMOD      = 10

BASE_MELEEDMGMOD = 8


HP_AGENT        = 48                            ;Ian as Agent
AR_AGENT        = 48

HP_NONAGENT     = 48                            ;Ian as civilian
AR_NONAGENT     = 0


        ;Enemy hitpoints
        ;Some key values:
        ;8 = falls from one 9mm bullet
        ;12 = falls from one Magnum bullet
        ;18 = falls from one point blank shotgun hit
        ;20 = falls from one sniper shot
        ;28 = falls from two point blank auto shotgun hits
        ;30 = falls from one grenade
        ;40 = falls from one missile

HP_THUG         = 8
AR_THUG         = 0

HP_STREETCOP    = 12
AR_STREETCOP    = 8

HP_TECH         = 12
AR_TECH         = 0

HP_SCIENTIST    = 12
AR_SCIENTIST    = 0

HP_GRUNT        = 12
AR_GRUNT        = 6

HP_GRUNTCMDR    = 18    ;Same as commando, actually
AR_GRUNTCMDR    = 6

HP_COMMANDO     = 18
AR_COMMANDO     = 6

HP_ENEMYAGENT   = 22
AR_ENEMYAGENT   = 6

HP_PRIEST       = 18
AR_PRIEST       = 12

HP_TECHBOSS    = 40
AR_TECHBOSS    = 20

HP_SUHRIM       = 120
AR_SUHRIM       = 40

HP_AHRIMAN      = 180
AR_AHRIMAN      = 40

HP_LILITH       = 160
AR_LILITH       = 40

HP_TURRET       = 30
AR_TURRET       = 0

HP_HEAVYTURRET  = 60
AR_HEAVYTURRET  = 0

HP_SECURITYBOT  = 90
AR_SECURITYBOT  = 0

HP_SPIDERBOT    = 30
AR_SPIDERBOT    = 0

HP_MINICOPTER   = 40
AR_MINICOPTER   = 0

HP_IAC          = 240
AR_IAC          = 0

HP_EXOSKELETON  = 200
AR_EXOSKELETON  = 0

HP_SEEKER       = 24
AR_SEEKER       = 0

HP_MUTANT1      = 18
AR_MUTANT1      = 0

HP_MUTANT2      = 120
AR_MUTANT2      = 0

HP_HOVERCAR     = HP_INVINCIBLE
AR_HOVERCAR     = 0

HP_BLACKHAND    = 30
AR_BLACKHAND    = 20

HP_JOANAGENT    = 40
AR_JOANAGENT    = 40

HP_GOAT         = 80
AR_GOAT         = 0

HP_IRONFIST     = 12
AR_IRONFIST     = 0

HP_BAT          = 5
AR_BAT          = 0


ACT_NONE        = 0
ACT_IANAGENT    = 1                             ;Ian in agent form
ACT_ITEM        = 2
ACT_SMOKECLOUD  = 3
ACT_SHRAPNEL    = 4
ACT_EXPLOSION   = 5
ACT_BULLET      = 6
ACT_RIFLEBULLET = 7
ACT_STEALTHBULLET = 8
ACT_SHURIKEN    = 9
ACT_DART        = 10
ACT_GRENADE     = 11
ACT_MELEEHIT    = 12
ACT_LASER       = 13
ACT_FLAME       = 14
ACT_ELECTRICITY = 15
ACT_PLASMA      = 16
ACT_MISSILE     = 17
ACT_PARASITE    = 18
ACT_PSIONIC     = 19
ACT_ZSIGN       = 20
ACT_LIFT1       = 21
ACT_DOORHINT    = 22
ACT_BALLOON     = 23
ACT_LIFT2       = 24
ACT_STREETCOP   = 25
ACT_IANCIVILIAN = 26                            ;Ian in nonagent form
ACT_THUG1A      = 27
ACT_THUG1B      = 28
ACT_THUG1C      = 29
ACT_THUG2A      = 30
ACT_THUG2B      = 31
ACT_THUG2C      = 32
ACT_WEAPONSHOP  = 33
ACT_TECH        = 34
ACT_TECHBOSS    = 35
ACT_TECHIAC     = 36
ACT_BYSTAND1    = 37
ACT_BYSTAND2    = 38
ACT_BYSTAND3    = 39
ACT_BYSTAND4    = 40
ACT_SCIENTISTMALE = 41
ACT_SCIENTISTFEMALE = 42
ACT_TECHLIGHT   = 43
ACT_GRUNT1      = 44
ACT_GRUNT2      = 45
ACT_GRUNT3      = 46
ACT_GRUNTCMDR   = 47
ACT_SNOWGRUNT   = 48
ACT_SNOWTECH    = 49
ACT_COMMANDO1   = 50
ACT_COMMANDO2   = 51
ACT_ENEMYAGENTM1 = 52
ACT_ENEMYAGENTM2 = 53
ACT_ENEMYAGENTF1 = 54
ACT_ENEMYAGENTF2 = 55
ACT_PRIEST1      = 56
ACT_PRIEST2      = 57
ACT_AHRIMAN      = 58
ACT_SUHRIM       = 59
ACT_LILITH       = 60
ACT_LILITHBYSTD  = 61
ACT_GOATIAC      = 62
ACT_CEILTURRET   = 63
ACT_FLOORTURRET  = 64
ACT_HEAVYTURRET  = 65
ACT_SECURITYBOT  = 66
ACT_SPIDERBOT    = 67
ACT_MINICOPTER   = 68
ACT_AHRIMANBYSTD = 69
ACT_SUHRIMBYSTD  = 70
ACT_IAC          = 71
ACT_EXOSKELETON  = 72
ACT_SEEKER       = 73
ACT_MUTANT1      = 74
ACT_MUTANT2      = 75
ACT_HOVERCAR     = 76
ACT_BLACKHAND   = 77
ACT_SARGE       = 78
ACT_SARGETRAITOR = 79
ACT_BLOWFISH    = 80
ACT_GOAT        = 81
ACT_SENTINEL2   = 82
ACT_EXAGENT     = 83
ACT_BARTENDER   = 84
ACT_BAND        = 85
ACT_JOANAGENT   = 86
ACT_IRONFIST    = 87
ACT_ULTRASHRED  = 88
ACT_LORDOBSKURIUS = 89
ACT_SATANAKHIA = 90
ACT_JOANCIVILIAN = 91
ACT_OBSKURIUSHEAD = 92
ACT_COUNCILHEADM = 93
ACT_COUNCILHEADF = 94
ACT_SENTINEL = 95
ACT_JOANLEVITATE = 96
ACT_BAT = 97
ACT_OBSERVER = 98
ACT_TVSCREEN = 99
ACT_AXESMITH = 100
ACT_SENTINELIAC = 101
ACT_SADOK = 102
ACT_WIDEMELEEHIT = 103

ACTI_PLAYER     = 0
ACTI_FIRSTNPC   = 1
ACTI_LASTNPC    = 6
ACTI_FIRSTITEM  = 7
ACTI_LASTITEM   = 10
ACTI_LASTLEVELDATA = ACTI_LASTITEM
ACTI_FIRSTPLRBLT = 11
ACTI_LASTPLRBLT = 16
ACTI_FIRSTNPCBLT = 15
ACTI_LASTNPCBLT = 19

AB_JUMP         = 1
AB_CLIMB        = 2
AB_HITWALL      = 4
AB_LANDED       = 8
AB_AUTOJUMP     = 16
AB_AUTOTURN     = 32
AB_AUTOTURNDONE = 64
AB_DUCK         = 128

ACB_JUMP        = 1                     ;Capability bits
ACB_DUCK        = 2
ACB_CLIMB       = 4
ACB_WALLFLIP    = 8
ACB_LONGJUMP    = 16
ACB_LEVITATE    = 32
ACB_FLY         = 64

AFB_ORGANIC     = 1                     ;Actor fighting bits: organic
AFB_HUMANOID    = 2                     ;Will drop weapons
AFB_DISAPPEAR   = 4                     ;Disappears after takedown
AFB_HEAVY       = 8                     ;Takes no impulse from bullets
AFB_REACTNOISE  = 16                    ;Reacts to noise
AFB_REACTVISUAL = 32                    ;Reacts to visual targets
AFB_REACTBODIES = 64                    ;Reacts to bodies (visual)
AFB_BOSS        = 128                   ;Can not be surprised, comradeagent only 50% effective



ADF_SIMPLE      = 1                     ;1 sprite
ADF_HUMANOID    = 2                     ;2 sprites, 2-part
ADF_NORMAL      = 4                     ;n sprites, 1-part
ADF_WEAPON      = 8                     ;Display weapon sprite
                                        ;(humanoid only)
ADF_FLICKER     = 64                    ;Actor will flicker
ADF_INVISIBLE   = 128                   ;Actor not drawn


DA_XLIMIT_LOW   = $ff                   ;Drawing limits
DA_XLIMIT_HIGH  = $0c
DA_YLIMIT_LOW   = $01
DA_YLIMIT_HIGH  = $09

AD_DISPLAYFLAGS = 0                     ;Display structure

ADH_DISPLAYFLAGS = 0                    ;Humanoid disp.structure
ADH_COLOR1      = 1                     ;Part1 color
ADH_BASEADD1    = 2                     ;Part1 add to file baseframe
ADH_LEFTFRADD1  = 3                     ;Part1 leftframe-add
ADH_SPRFILE1    = 4                     ;Part1 spritefile
ADH_FRAMEPTR1   = 5                     ;Part1 frames
ADH_COLOR2      = 7                     ;Part1 color
ADH_BASEADD2    = 8                     ;Part1 add to file baseframe
ADH_LEFTFRADD2  = 9                     ;Part1 leftframe-add
ADH_SPRFILE2    = 10                    ;Part1 spritefile
ADH_FRAMEPTR2   = 11                    ;Part1 frames

ADN_DISPLAYFLAGS = 0                    ;Normal disp.structure
ADN_COLOR        = 1                    ;Color override
ADN_BASEADD      = 2                    ;Add to file baseframe
ADN_LEFTFRADD    = 3                    ;Left frame-add
ADN_SPRFILE      = 4                    ;Spritefile num.
ADN_FRAMEPTR     = 5                    ;Framepointer
ADN_FRADD        = 7                    ;Total num.of frames
ADN_SPRITES      = 8                    ;Total num.of sprites

ADS_DISPLAYFLAGS = 0                    ;Simple disp.structure
ADS_COLOR       = 1                     ;Color override
ADS_BASEADD     = 2
ADS_LEFTFRADD   = 3                     ;Left frame-add
ADS_SPRFILE     = 4                     ;Spritefile
ADS_FRAMES      = 5                     ;Framedata

AD_AIJUMP       = 0                     ;Logic struc. AI rout.
AD_MOVEJUMP     = 2                     ;Moveroutine
AD_SIZEHORIZ    = 4                     ;Size for collision
AD_SIZEDOWN     = 5
AD_SIZEUP       = 6
AD_SIZEUPDUCK   = 7
AD_DEFAULTBATT  = 8                     ;Default armor & HP
AD_DEFAULTHP    = 9
AD_FIGHTBITS    = 10                    ;Fighting bitfield
AD_CAPBITS      = 11                    ;Capability bitfield
AD_DEFAULTGROUP = 12                    ;Default group alliance

AD_SPEEDPOS     = 13                    ;Speeds & accel.
AD_SPEEDNEG     = 14
Ad_ACCELPOS     = 15
AD_ACCELNEG     = 16
AD_JUMPSPEED    = 17
AD_CLIMBSPEED   = 18
AD_BRAKEACCEL   = 19

AD_ATTACKXMOD   = 20                    ;Attack mod
AD_ATTACKYMOD   = 21
AD_ATTACKYMODDUCK = 22
AD_TDSOUND      = 23                    ;Takedown sound
AD_TDYMOD       = 24                    ;Y-mod
AD_TDSCORE      = 25                    ;Score (16bit) for takedown
                                        ;(double for nonlethal)

AD_REACTMODE    = 27                    ;Reaction to enemies
AD_PATROLRADIUS = 28                    ;Visual detection limit
AD_ALERTRADIUS  = 29                    ;Vis. det. limit on alertness
AD_PATROLIDLETIME = 30
AD_BOREDTIME    = 31
AD_ATTACKPROB   = 32                    ;Attack probability
AD_MELEEPROB    = 33                    ;Melee attack probability
AD_DUCKPROB     = 34                    ;Ducking probability. Note! This is
AD_DUCKEVASIVEPROB = 35
AD_DUCKEXITPROB = 36                    ;counted from $ff downwards because
                                        ;the same random value is used both
                                        ;for ducking & attacking!
AD_DUCKATTACKPROB = 37                  ;Ducking attack probability
AD_JUMPPROB     = 38                    ;Probability for jump instead of duck
AD_PATROLIDLEPROB = 39                  ;Probability for going idle in patrol
ADLSTRUCLEN     = 40                    ;Logic structure total length

EXPL_PROB       = $80                   ;Probability for big explosion

;-------------------------------------------------------------------------------
; INITACTORS
;
; Removes all actors
;
; Parameters: -
; Returns: -
; Modifies: A,X,Y
;-------------------------------------------------------------------------------

initactors:     ldx #NUMACT-1
ina_loop:       jsr removeactor
                dex
                bpl ina_loop
                lda #$00                        ;Reset big explosion
                sta bigexplcount
                rts

;-------------------------------------------------------------------------------
; DRAWACTORS
;
; Draws actors as sprites
;
; Parameters: -
; Returns: -
; Modifies: A,X,Y
;-------------------------------------------------------------------------------

drawactors:     lda actd+ACTI_PLAYER
                bmi da_playerleft
                lda scrollcenterx
                cmp #SCROLLCENTER_X-CENTER_OFFSET
                beq da_scok
                dec scrollcenterx
                jmp da_scok
da_playerleft:  lda scrollcenterx
                cmp #SCROLLCENTER_X+CENTER_OFFSET
                beq da_scok
                inc scrollcenterx
da_scok:        lda sprsubxl
                sta ia_prevsubxl+1
                lda sprsubxh
                sta ia_prevsubxh+1
                lda sprsubyl
                sta ia_prevsubyl+1
                lda sprsubyh
                sta ia_prevsubyh+1
                lda agenttvscreen               ;Agency TV screen update
                sta actd_tvscreenframe
                inc itemflash+1                   ;Item flashing
itemflash:      lda #$00
                lsr
                lsr
                and #$03
                tax
                lda itemcolortbl,x
                sta actd_item+ADN_COLOR         ;Select item display color
dract_restart:  ldx #$00
                stx numspr
                stx depacksprflag               ;Assume no depacking
dract_loop:     lda #$00
                sta actdb,x                   ;Assume actor not drawn
                lda actt,x
                bne dract_notzero
dract_next:     inx
                cpx #NUMACT
                bcc dract_loop
                ldx numspr                      ;Process flickering for this
                beq dract_skipflicker           ;frame
                dex
dract_flicker:  ldy spract,x
                lda actdb,y
                beq dract_doflicker2            ;If actor removed, hide it
                and #ADF_FLICKER
                beq dract_noflicker
                tya
                lsr
                bcc dract_noflicker
dract_doflicker:lda sprc,x
dract_doflicker2:
                ora #$80
                sta sprc,x
dract_noflicker:dex
                bpl dract_flicker
dract_skipflicker:
                ldx numspr
                lda #$ff                        ;Set the Y-coords of the
dract_unusedsprloop:                            ;unused sprites to $ff
                sta spry,x
                inx
                cpx #NUMSPR+1
                bcc dract_unusedsprloop
                ldy zoneflash                   ;Zone number to be flashed
                inc zoneflashcount
                lda zoneflashcount
                lsr
                and #$03
                tax
                lda flashtbl1,x
                sta zonebg2,y
                lda flashtbl2,x
                sta zonebg3,y
                rts

dract_drawskip: jmp dract_drawdone

dract_notzero:  stx temp7                               ;Store actornumber
                asl
                tay
                lda actdtbl-2,y                         ;Get display structure
                sta actdptrlo
                lda actdtbl-1,y
                sta actdptrhi
                ldy #AD_DISPLAYFLAGS                    ;Get displayflags
                lda (actdptrlo),y
                bmi dract_drawskip                      ;Invisible
                sta temp3
                lda actxl,x                             ;X-subtract
                and #$f0
                sta actprevxl,x
                sec
                sbc sprsubxl
                sta temp1
                lda actxh,x
                sta actprevxh,x
                sbc sprsubxh
                bmi dract_xneg
                cmp #DA_XLIMIT_HIGH
                bcs dract_drawskip
                bcc dract_xok
dract_xneg:     cmp #DA_XLIMIT_LOW
                bcc dract_drawskip
                and #$0f
dract_xok:      tay
                lda temp1
                lsr
                lsr
                lsr
                lsr
                ora coordtblx,y
                sta temp1
                lda actyl,x                             ;Y-subtract
                sta actprevyl,x
                sec
                sbc sprsubyl
                sta temp2
                lda actyh,x
                sta actprevyh,x
                sbc sprsubyh
                bmi dract_drawskip
                cmp #DA_YLIMIT_LOW
                bcc dract_drawskip
                cmp #DA_YLIMIT_HIGH
                bcs dract_drawskip
dract_yok:      and #$07
                tay
                lda temp2
                lsr
                lsr
                lsr
                ora coordtbly,y
                sta temp2

                cpx #ACTI_PLAYER                ;The player actor?
                bne dract_noscroll
                lda temp1
                sec
                sbc scrollcenterx
                bcc dract_scrollxneg
dract_scrollxpos:
                cmp #2*8
                bcc dract_scrollxok
                lda #2*8
                bne dract_scrollxok
dract_scrollxneg:
                cmp #-2*8
                bcs dract_scrollxok
                lda #-2*8
dract_scrollxok:asl
                and #$fe
                sta scrollsx
                lda temp2
                sec
                sbc scrollcentery
                bcc dract_scrollyneg
dract_scrollypos:
                cmp #4*8
                bcc dract_scrollyok
                lda #4*8
                bne dract_scrollyok
dract_scrollyneg:
                cmp #-4*8
                bcs dract_scrollyok
                lda #-4*8
dract_scrollyok:and #$fe
                sta scrollsy

dract_noscroll: lda actf1,x                             ;Take framenum.
                ldy actd,x                              ;Take dir.
                bpl dract_faceright1
                ldy #ADN_LEFTFRADD
                clc
                adc (actdptrlo),y
dract_faceright1:
                sta temp4                               ;Save frameindex
                lda actfls,x                            ;Color flashing override
                bne dract_color1ok
                ldy #ADN_COLOR                          ;Actor's color override
                lda (actdptrlo),y
dract_color1ok: sta dract_color+1
                ldy #ADN_SPRFILE                        ;Take spritefilenum.
                lda (actdptrlo),y
                bmi dract_compressed                    ;Use the packed
                tay                                     ;spritefile?
                lda #$00                                ;Reset spritefile time
                sta sprfiletime,y
                lda sprfilebaseframe,y
                bne dract_baseframeok1
                jmp dract_demandload                    ;Demand-load spritefile!

dract_simple:   lda actdptrlo                   ;In a Simple actor, the
                adc #ADS_FRAMES-1               ;framestructure is in the
                sta actfptrlo                   ;actorstructure itself
                lda actdptrhi
                adc #$00
                sta actfptrhi
                jsr dract_addsprite
                jmp dract_drawdone

dract_compressed:
                lda #$00
dract_baseframeok1:
                ldy #ADN_BASEADD
                clc
                adc (actdptrlo),y
                sta dract_baseframe+1                   ;Save baseframe
                lda temp3
                sta actdb,x
                lsr
                bcs dract_simple
                ldy #ADN_FRAMEPTR                       ;Common for
                lda (actdptrlo),y                       ;Normal & Humanoid
                sta actfptrlo                           ;actors: take
                iny                                     ;framepointer
                lda (actdptrlo),y
                sta actfptrhi
                lda temp3
                and #ADF_HUMANOID
                bne dract_humanoid
dract_normal:   ldy #ADN_FRADD
                lda (actdptrlo),y
                sta dract_normalframeadd+1
                iny
                lda (actdptrlo),y
                sta temp6
dract_normalloop:
                jsr dract_addsprite
                lda temp4
                clc
dract_normalframeadd:
                adc #$00
                sta temp4
                dec temp6
                bne dract_normalloop
dract_normaldone:
dract_nofreespr:jmp dract_drawdone

dract_humanoid:
                jsr dract_addsprite
                ldx temp7
                ldy #ADH_FRAMEPTR2              ;Take second framepointer
                lda (actdptrlo),y
                sta actfptrlo
                iny
                lda (actdptrlo),y
                sta actfptrhi
                lda actf2,x                     ;Take framenum.
                ldy actd,x                      ;Take dir.
                bpl dract_faceright2
                ldy #ADH_LEFTFRADD2
                clc
                adc (actdptrlo),y
dract_faceright2:
                sta temp4                       ;Save frameindex
                lda actfls,x                    ;Color flashing override
                bne dract_color2ok
                ldy #ADH_COLOR2                 ;Actor's color override
                lda (actdptrlo),y
dract_color2ok: sta dract_color+1
                ldy #ADH_SPRFILE2               ;Take spritefilenum.
                lda (actdptrlo),y
                tay
                lda #$00                        ;Reset spritefile time
                sta sprfiletime,y
                lda sprfilebaseframe,y
                bne dract_baseframeok2
                jmp dract_demandload            ;Demand-load spritefile!
dract_baseframeok2:
                ldy #ADH_BASEADD2
                clc
                adc (actdptrlo),y
                sta dract_baseframe+1           ;Save baseframe
                lda actfls,x                    ;Color flashing override
                bne dract_hcolor2ok
                ldy #ADH_COLOR2                 ;Human color override
                lda (actdptrlo),y
                sta dract_color+1
dract_hcolor2ok:
                jsr dract_addsprite
                ldx temp7
                lda temp3
                and #ADF_WEAPON
                beq dract_hdone
                lda #$00
                sta dract_color+1               ;No color override for the weap.
                lda actwf,x                     ;Weaponframe?
                cmp #WF_NONE
                beq dract_hdone
                cmp #WF_NONE+$80
                beq dract_hdone
                ldx numspr
                cpx #NUMSPR
                bcs dract_hdone
                jsr dract_packedsprite2
dract_hdone:
dract_drawdone: ldx temp7
                lda #$00                        ;Reset flashing
                sta actfls,x
                jmp dract_next

dract_addsprite:ldx numspr
                cpx #NUMSPR
                bcs dract_asnofree
                ldy temp4
dract_baseframe:lda #$00
                beq dract_packedsprite
                adc (actfptrlo),y
                bcs dract_asnofree                ;Skip sprite
                sta sprf,x
                tay
dract_color:    lda #$00                          ;Color override
                bne dract_colorok
                lda sprcol-FIRSTSPRITEFRAME,y
dract_colorok:  sta sprc,x
                lda temp1
                adc sprhotspotx-FIRSTSPRITEFRAME,y
                sta sprx,x
                clc
                adc sprconnectspotx-FIRSTSPRITEFRAME,y
                sta temp1
                lda temp2
                clc
                adc sprhotspoty-FIRSTSPRITEFRAME,y
                sta spry,x
                clc
                adc sprconnectspoty-FIRSTSPRITEFRAME,y
                sta temp2
                lda temp7
                sta spract,x
                inc numspr
dract_asnofree: rts

dract_packedsprite:
                lda (actfptrlo),y
dract_packedsprite2:
                tay
                bmi dract_psleft
                lda dract_color+1
                bne dract_pscolorok
                lda dspr_color,y
dract_pscolorok:sta sprc,x
                lda temp1
                adc dspr_hotspotx,y
                sta sprx,x
                lda temp2
                clc
                adc dspr_hotspoty,y
dract_pscommon: sta spry,x
                lda temp7
                sta spract,x
                clc
                adc #FIRSTDEPACKFRAME
                sta sprf,x
                tya
                ldy temp7
                cmp dsprprevf,y
                beq dract_pssame
                sta dsprf,y
                inc depacksprflag
dract_pssame:   inc numspr
                rts

dract_psleft:   lda dract_color+1
                bne dract_pslcolorok
                lda dspr_color-$80,y
dract_pslcolorok:sta sprc,x
                lda temp1
                adc dspr_reversehotspotx-$80,y
                sta sprx,x
                lda temp2
                clc
                adc dspr_hotspoty-$80,y
                jmp dract_pscommon

dract_demandload:
                tya
                jsr loadsprites
                jmp dract_restart

;-------------------------------------------------------------------------------
; MOVEACTORS
;
; Calls move & AI routines of all actors
;
; Parameters: -
; Returns: -
; Modifies: A,X,Y
;-------------------------------------------------------------------------------

moveactors:     lda #$00
                sta cbc_soundcount+1
;                lda tm_strobe+1                 ;AI strobe (execute only half)
;                eor #$01
;                sta tm_strobe+1
                ldx #NUMACT-1
mvact_loop:     lda actt,x
                beq mvact_next
                jsr mvact_sub2
mvact_next:     dex
                bpl mvact_loop
                rts
mvact_sub2:     asl
                tay
                lda actltbl-2,y                 ;Get logic structure
                sta actlptrlo
                lda actltbl-1,y
                sta actlptrhi
mvact_sub:      ldy #AD_SIZEHORIZ               ;Find out size for collision
                lda (actlptrlo),y
                sta actsizex,x
                iny
                lda (actlptrlo),y
                sta actsizedown,x
                iny
                lda actbits,x
                and #AB_DUCK
                beq mvact_notducking
                iny
mvact_notducking:
                lda (actlptrlo),y
                sta actsizeup,x
                ldy #AD_AIJUMP+1                ;Perform actor AI & move
                lda (actlptrlo),y
                beq mvact_skipai
                sta mvact_aijump+2
                dey
                lda (actlptrlo),y
                sta mvact_aijump+1
                ldy #AD_FIGHTBITS
                lda (actlptrlo),y               ;Fighting bitfield
                sta actfb,x
                iny
                lda (actlptrlo),y               ;Capability bitfield
                sta actcapbits
                lda acthp,x                     ;No AI if dead
                beq mvact_skipai
                lda actctrl,x                   ;Control/previous control only
                sta actprevctrl,x               ;for actors that use AI
mvact_aijump:   jsr $1000
mvact_skipai:   ldy #AD_MOVEJUMP
                lda (actlptrlo),y
                sta mvact_movejump+1
                iny
                lda (actlptrlo),y
                sta mvact_movejump+2
mvact_movejump: jmp $1000

;-------------------------------------------------------------------------------
; INTERPOLATEACTORS
;
; Interpolates actor movements for second frame (fast frame)
;
; Parameters: -
; Returns: -
; Modifies: A,X,Y
;-------------------------------------------------------------------------------

interpolateactors:
                lda sprsubxl                    ;Calculate how much the
                sec                             ;scrolling has changed
ia_prevsubxl:   sbc #$00
                sta temp3
                lda sprsubxh
ia_prevsubxh:   sbc #$00
                sta temp4
                lda sprsubyl
                sec
ia_prevsubyl:   sbc #$00
                sta temp5
                lda sprsubyh
ia_prevsubyh:   sbc #$00
                sta temp6
                ldx #NUMACT-1
ia_loop:        lda actdb,x                     ;Actor was drawn?
                beq ia_notdrawn
                lda actxl,x                     ;Calculate average movement
                sec                             ;of actor in X-direction
                sbc actprevxl,x
                sta temp1
                lda actxh,x
                sbc actprevxh,x
                bpl ia_avgxpos
                lsr
                ror temp1
                ora #$80
                bmi ia_avgxok
ia_avgxpos:     lsr
                ror temp1
ia_avgxok:      sta temp2
                lda temp1
                sec                             ;Convert the deltavalue to
                sbc temp3                       ;screen coordinates
                sta temp1
                lda temp2
                sbc temp4
                and #$0f
                tay
                lda temp1
                lsr
                lsr
                lsr
                lsr
                ora coordtblx,y
                sta actprevxl,x
                lda actyl,x                     ;Calculate average movement
                sec                             ;of actor in Y-direction
                sbc actprevyl,x
                sta temp1
                lda actyh,x
                sbc actprevyh,x
                bpl ia_avgypos
                lsr
                ror temp1
                ora #$80
                bmi ia_avgyok
ia_avgypos:     lsr
                ror temp1
ia_avgyok:      sta temp2
                lda temp1
                sec                             ;Convert the deltavalue to
                sbc temp5                       ;screen coordinates
                sta temp1
                lda temp2
                sbc temp6
                and #$07
                tay
                lda temp1
                lsr
                lsr
                lsr
                ora coordtbly,y
                sta actprevyl,x
ia_notdrawn:    dex
                bmi ia_loopdone
                jmp ia_loop
ia_loopdone:    ldx numspr                      ;Any sprites?
                beq ia_done
                dex
ia_sprloop:     ldy spract,x                    ;Add deltavalues to sprites'
                lda actdb,y
                beq ia_sprskip                  ;If actor removed, no processing
ia_sprok:       and #ADF_FLICKER
                beq ia_noflicker
                lda sprc,x                      ;Process flickering
                eor #$80
                sta sprc,x
ia_noflicker:   lda sprx,x
                clc
                adc actprevxl,y
                sta sprx,x
                lda spry,x
                clc
                adc actprevyl,y
                sta spry,x
ia_sprskip:     dex
                bpl ia_sprloop
ia_done:        rts

;-------------------------------------------------------------------------------
; MOVEACTORX
; MOVEACTORXDIRECT
; SPAWNXMOD
;
; Does X-movement of an actor. MOVEACTORXDIRECT should be used with care
; because it assumes that the flags reflect correctly the A register.
;
; Parameters: X: Actor number, A: Amount of move (only in MOVEACTORXDIRECT)
;             or Y: Actor number in SPAWNXMOD
; Returns: -
; Modifies: A, temp1 (only SPAWNYMOD)
;-------------------------------------------------------------------------------

moveactorx:     lda actsx,x
moveactorxdirect:
                clc
                beq mactx_pnot
                bmi mactx_neg
mactx_pos:      adc actxl,x
                sta actxl,x
                bcc mactx_pnot
                inc actxh,x
mactx_pnot:     rts
mactx_neg:      adc actxl,x
                sta actxl,x
                bcs mactx_nnot
                dec actxh,x
mactx_nnot:     rts

spawnxmod:      stx temp1
                pha
                tya
                tax
                pla
                jsr moveactorxdirect
                ldx temp1
                rts

;-------------------------------------------------------------------------------
; MOVEACTORY
; MOVEACTORYDIRECT
; SPAWNYMOD
;
; Does Y-movement of an actor. MOVEACTORYDIRECT should be used with care
; because it assumes that the flags reflect correctly the A register.
;
; Parameters: X: Actor number, A: Amount of move (only in MOVEACTORYDIRECT)
;             or Y: Actor number in SPAWNYMOD
; Returns: -
; Modifies: A, temp1 (only SPAWNYMOD)
;-------------------------------------------------------------------------------

moveactory:     lda actsy,x
moveactorydirect:
                clc
                beq macty_pnot
                bmi macty_neg
macty_pos:      adc actyl,x
                sta actyl,x
                bcc macty_pnot
                inc actyh,x
macty_pnot:     rts
macty_neg:      adc actyl,x
                sta actyl,x
                bcs macty_nnot
                dec actyh,x
macty_nnot:     rts

spawnymod:      stx temp1
                pha
                tya
                tax
                pla
                jsr moveactorydirect
                ldx temp1
                rts

;-------------------------------------------------------------------------------
; ACCACTORX
;
; Does X-acceleration of an actor. Note: acceleration and speed limit must
; always be same sign!
;
; Parameters: X: Actor number, A: acceleration, Y: Speed limit
; Returns: -
; Modifies: A,Y,temp6
;-------------------------------------------------------------------------------

accactorx:      clc
                sty temp6
aact_xok:       tay                             ;Just to get the flags
                bmi aact_xneg
aact_xpos:      adc actsx,x
                bvs aact_xlimit
                bmi aact_xposnl                 ;If speed still negative,
                cmp temp6                       ;need not check limit
                bcc aact_xposnl
aact_xlimit:    lda temp6
aact_xposnl:    sta actsx,x
                rts
aact_xneg:      adc actsx,x
                bvs aact_xlimit
                bpl aact_xnegnl
                cmp temp6
                bcs aact_xnegnl
                lda temp6
aact_xnegnl:    sta actsx,x
                rts

;-------------------------------------------------------------------------------
; ACCACTORY
;
; Does Y-acceleration of an actor. Note: acceleration and speed limit must
; always be same sign!
;
; Parameters: X: Actor number, A: acceleration, Y: Speed limit
; Returns: -
; Modifies: A,Y,temp6
;-------------------------------------------------------------------------------

accactory:      clc
                sty temp6
aact_yok:       tay                             ;Just to get the flags
                bmi aact_yneg
aact_ypos:      adc actsy,x
                bvs aact_ylimit
                sta actsy,x
                bmi aact_yposnl                 ;If speed still negative,
                cmp temp6                       ;need not check limit
                bcc aact_yposnl
aact_ylimit:    lda temp6
                sta actsy,x
aact_yposnl:    rts
aact_yneg:      adc actsy,x
                bvs aact_ylimit
                sta actsy,x
                bpl aact_ynegnl
                cmp temp6
                bcs aact_ynegnl
                lda temp6
                sta actsy,x
aact_ynegnl:    rts

;-------------------------------------------------------------------------------
; BRAKEACTORX
;
; Brakes X-speed of an actor towards zero.
;
; Parameters: X: Actor number, A: deceleration (always positive)
; Returns: -
; Modifies: A,temp6
;-------------------------------------------------------------------------------

brakeactorx:    sta temp6
                lda actsx,x
                beq bact_xdone
                bmi bact_xneg
bact_xpos:      sec
                sbc temp6
                bpl bact_xdone
                lda #$00
bact_xdone:     sta actsx,x
                rts
bact_xneg:      clc
                adc temp6
                bmi bact_xdone
                lda #$00
                sta actsx,x
                rts

;-------------------------------------------------------------------------------
; REVERSEACTOR
; REVERSEXSPEED
;
; Reverses actor direction / X-speed.
;
; Parameters: X: Actor number
; Returns: A: New direction / speed
; Modifies: A
;-------------------------------------------------------------------------------

reverseactor:   lda actd,x
                eor #$80
                sta actd,x
                rts

reversexspeed:  lda actsx,x
reversexspeed2: jsr negate
                sta actsx,x
                rts

;-------------------------------------------------------------------------------
; CHECKHEADBUMP
;
; Checks if actor's head has hit the ceiling
;
; Parameters: X: Actor number
; Returns: -
; Modifies: A,Y
;-------------------------------------------------------------------------------

checkheadbump:  lda #-4
                jsr getcharposinfooffset
                and #CI_OBSTACLE
                beq chkl_noheadbump
                lda #$00
                sta actsy,x
chkl_noheadbump:clc
                rts

;-------------------------------------------------------------------------------
; CHECKSIDEOBST
; CHECKJUMPOBST
;
; Performs X-move of actor but if an obstacle blocks the way, does no
; movement. CHECKSIDEOBST checks one char higher.
;
; Parameters: X:Actor number
; Returns: C=0 no obstacle, C=1 obstacle
; Modifies: A,Y,temp1,temp2,temp3,temp4
;-------------------------------------------------------------------------------

checksideobst:  lda actsx,x                     ;If X-speed zero, do nothing
                beq cso_ok
                jsr moveactorxdirect
                lda #-1
                jsr getcharposinfooffset
cso_common:     and #CI_OBSTACLE
                beq cso_ok
cso_restorepos: lda actsx,x
                sta acthitwalld,x               ;Copy direction of hitting wall
                jsr negate
                jsr moveactorxdirect
                lda actbits,x
                ora #AB_HITWALL
                sta actbits,x
                sec
                rts
cso_ok:         clc
                rts

checkjumpobst:  lda actsx,x                     ;If X-speed zero, do nothing
                beq cso_ok
                jsr moveactorxdirect
                jsr getcharposinfo
                jmp cso_common

;-------------------------------------------------------------------------------
; CHECKLANDING
;
; Checks if a groundbased actor who jumps, has landed.
; Note: to ensure correct operation do things in this order on one update:
; - Accelerate actor if needed
; - Move actor
; - Check landing
;
; Parameters: -
; Returns: C=0 no landing, C=1 landed
; Modifies: A,Y,temp2-temp3
;-------------------------------------------------------------------------------

checklanding:   lda #CI_GROUND
checklandingspecial:
                sta temp2
                lda actsy,x                     ;If speed negative, no check
                bmi cso_ok
                lda actyl,x                     ;Did the actor go "through" a
                and #$3f                        ;char?
                sec
                sbc actsy,x
                bcs chkl_notabove
                lda #-1                         ;Check from one char
                jsr getcharposinfooffset        ;above (actor went "through"
                sta temp3                       ;the ground)
                and temp2
                beq chkl_notabove
chkl_common2:   jsr chkl_common
                bcs cst_up
chkl_notabove:  jsr getcharposinfo              ;Then check at the current
                sta temp3                       ;char
                and temp2
                beq chkl_noground
                jsr chkl_common
                jmp cst_ground2
chkl_noground:  jsr checkliftcoll
                bcc chkl_noground2
chkl_common:    lda #$00
                sta actsy,x
                lda actbits,x
                and #$ff-AB_JUMP                ;Clear jump bit
                ora #AB_LANDED
                sta actbits,x
                sec
chkl_noground2: rts

;-------------------------------------------------------------------------------
; CHECKSTAIRS
;
; Checks if there is ground at actor's position or above/below. Will move
; player one/two char(s) up or down, if necessary.
;
; Parameters: X:Actor number
; Returns: C=0 no ground, C=1 there's ground
;          temp3 = result of GETCHARINFO
; Modifies: A,Y,temp3
;-------------------------------------------------------------------------------

cst_up:         lda #-64
                jsr moveactorydirect
                jmp cst_ground
checkstairs:    jsr getcharposinfo
                sta temp3
                lsr
                bcs cst_ground
                lda #1
                jsr getcharposinfooffset
                sta temp3
                lsr
                bcs cst_down
                lda #-1
                jsr getcharposinfooffset
                sta temp3
                lsr
                bcs cst_up
                jmp checkliftcoll
cst_down:       lda #64
                jsr moveactorydirect
cst_ground:     lda #$00                        ;Reset actor Y-speed
                sta actsy,x
cst_ground2:
                lda actxl,x
                lsr
                and #$1c
                sta maptemp1
                lda temp3
                and #$e0
                ora maptemp1
                lsr
                lsr                             ;Get slopetable-offset
                tay
                lda actyl,x
                and #$c0
                ora slopetbl,y
                sta actyl,x
                cpx #NUMCOMPLEXACT              ;Lastground setting only for
                bcs cst_groundok                ;complex actors
cst_blocknum:   ldy #$00
                lda blkcoltbl,y                 ;No pathfinding-block?
                bpl cst_normalground
                lda #$00                        ;In that case, use ground
                sta actlastgroundyl,x           ;1 block below for pathfinding
                lda actyh,x
                clc
                adc #$01
                sta actlastgroundyh,x
                jmp cst_groundok
cst_normalground:
                jsr storelastgroundy
cst_groundok:
                sec
                rts

checkstairs_preferup:
                lda #-1
                jsr getcharposinfooffset
                sta temp3
                lsr
                bcs cst_up
                jsr getcharposinfo
                sta temp3
                lsr
                bcs cst_ground
                lda #1
                jsr getcharposinfooffset
                sta temp3
                lsr
                bcs cst_down

        ;Lift collision here

checkliftcoll:  ldy #NUMCOMPLEXACT-1
clc_loop:       lda actgrp,y                    ;Negative group = lift
                bmi clc_found
clc_next:       dey
                bne clc_loop
                clc
                rts
clc_found:      lda actxh,y                     ;Check for X coord OK
                sec
                sbc actxh,x
                cmp #$02
                bcs clc_next
                lda actyl,x                     ;Check Y coord: at or
                sec                             ;below lift within 12 pixels
                sbc actyl,y                     ;or above lift within 4 pixels
                sta temp2
                lda actyh,x
                sbc actyh,y
                beq chkl_below
                cmp #$ff
                bne clc_next
chkl_above:     lda temp2
                cmp #LIFTABOVELIMIT
                bcc clc_next
                bcs chkl_yok
chkl_below:     lda temp2
                cmp #LIFTBELOWLIMIT
                bcs clc_next
chkl_yok:       lda actyl,y                     ;Move actor at lift's Y coord
                sta actyl,x
                lda actyh,y
                sta actyh,x
                cpx #NUMCOMPLEXACT
                bcs chkl_skipground
                jsr storelastgroundy            ;Update last known ground Y
chkl_skipground:

                lda #$01                        ;Slight downward speed to mark
                sta actsy,x                     ;that we're on a lift (for
                                                ;pathfinding that's tracking
                                                ;this actor)
                sec                             ;Success
                rts

;-------------------------------------------------------------------------------
; CHECKCOLLISION
;
; Checks if two actors have collided. They must both exist!
;
; Parameters: X: Actor number
;             Y: Actor number
; Returns: C=1 actors collided
; Modifies: A,temp1
;-------------------------------------------------------------------------------

checkcollision: lda actxl,x
                sec
                sbc actxl,y
                sta temp1
                lda actxh,x
                sbc actxh,y
                bpl cc_xpos
                lda actxl,y
                sec
                sbc actxl,x
                sta temp1
                lda actxh,y
                sbc actxh,x
cc_xpos:        lsr
                ror temp1
                lsr
                ror temp1
                lsr
                bne cc_toofar
                ror temp1
                lda actsizex,x
                adc actsizex,y
                cmp temp1
                bcs cc_xok
cc_toofar:      clc
                rts
cc_xok:         lda actyl,x
                sec
                sbc actyl,y
                sta temp1
                lda actyh,x
                sbc actyh,y
                bpl cc_ypos
cc_yneg:        lda actyl,y
                sec
                sbc actyl,x
                sta temp1
                lda actyh,y
                sbc actyh,x
                lsr
                ror temp1
                lsr
                ror temp1
                lsr
                bne cc_toofar
                ror temp1
                lda actsizedown,x
                adc actsizeup,y
                cmp temp1
                rts
cc_ypos:        lsr
                ror temp1
                lsr
                ror temp1
                lsr
                bne cc_toofar
                ror temp1
                lda actsizeup,x
                adc actsizedown,y
                cmp temp1
                rts

;-------------------------------------------------------------------------------
; TURNTOUP/DOWNSTAIRS
;
; Turns a character to the direction of either up or down leading stairs,
; but only if that's the target's direction! (for AI)
;
; Parameters: X:Actor number
; Returns: actd possibly changed
; Modifies: A,Y,temp1,temp3
;-------------------------------------------------------------------------------
turntodownstairs:
                lda #1
                bne tts_common

turntoupstairs: lda #-1
tts_common:     sta temp3
                lda actd,x
                bmi tts_leftfirst

tts_rightfirst: lda targetxdist
                bpl tts_leftnotok
                ldy #1
                jsr getcharposinfoxy3
                and #CI_STAIRS
                bne tts_rightok
                ldy #-1
                jsr getcharposinfoxy3
                and #CI_STAIRS
                bne tts_leftok
                ldy #-2
                jsr getcharposinfoxy3
                and #CI_STAIRS
                beq tts_leftnotok
tts_leftok:     lda #$80
tts_commonok:   sta actd,x
tts_leftnotok:  rts
tts_rightok:    lda #$00
                beq tts_commonok

tts_leftfirst:  lda targetxdist
                bmi tts_leftnotok
                ldy #-1
                jsr getcharposinfoxy3
                and #CI_STAIRS
                bne tts_leftok
                ldy #1
                jsr getcharposinfoxy3
                and #CI_STAIRS
                bne tts_rightok
                ldy #2
                jsr getcharposinfoxy3
                and #CI_STAIRS
                bne tts_rightok
                beq tts_leftnotok

;-------------------------------------------------------------------------------
; PROCESSHEALTH
;
; Process time-based health add/subtract for actors. Also increases game clock,
; decrements level alert status, and handles big explosions
;
; Parameters: -
; Returns: -
; Modifies: A,X,Y
;-------------------------------------------------------------------------------

ph_damage:      inc acthptime,x
                lda acthpdelta,x
                jsr punish_noarmor
                jmp ph_next


processhealth:  lda plrbatttime
                beq ph_battskip
                ldx #ACTI_PLAYER
                jsr getactptr
                ldy #AD_DEFAULTBATT
                dec plrbatttime
                lda plrbattdelta
                clc
                adc actbatt+ACTI_PLAYER
                bvs ph_battmax
                bmi ph_battmin
                cmp (actlptrlo),y
                bcc ph_battok
ph_battmax:     lda #$00
                sta plrbatttime
                lda (actlptrlo),y
                bne ph_battok
ph_battmin:     lda #$00
ph_battok:      sta actbatt+ACTI_PLAYER
ph_battskip:
ph_start:       ldx #$00
                bne ph_alertskip                        ;Decrement level alert
                lda levelalert                          ;counter
                beq ph_alertskip
                dec levelalert
ph_alertskip:   lda actt,x
                beq ph_next
                lda acthptime,x
                beq ph_next
                bmi ph_damage
                dec acthptime,x
                jsr getactptr
                lda acthpdelta,x
                clc
                adc acthp,x
                ldy #AD_DEFAULTHP
                cmp (actlptrlo),y
                bcc ph_posok
                lda #$00
                sta acthptime,x
                lda (actlptrlo),y
ph_posok:       sta acthp,x
ph_next:        inx
                cpx #NUMCOMPLEXACT
                bcc ph_notover
                ldx #$00
ph_notover:     stx ph_start+1
                lda bigexplcount                ;Big explosion?
                beq increaseclock
                jsr random                      ;Probability for starting
                cmp #EXPL_PROB                  ;new explosion
                bcs increaseclock
                ldy #ACTI_FIRSTPLRBLT+2         ;Free actor for explosion
                lda #ACTI_LASTNPCBLT
                jsr getfreeactor
                bcc increaseclock
                lda #SFX_EXPLOSION
                jsr playsfx
                jsr bigexplmod
                lda temp1
                sta temp3
                lda temp2
                sta temp4
                jsr bigexplmod
                lda #ACT_EXPLOSION
                sta actt,y
                lda bigexplxl
                clc
                adc temp1
                sta actxl,y
                lda bigexplxh
                adc temp2
                sta actxh,y
                lda bigexplyl
                clc
                adc temp3
                sta actyl,y
                lda bigexplyh
                adc temp4
                sta actyh,y
                dec bigexplcount

increaseclock:  lda ti_frame                   ;Increase game clock
                clc
                adc #2
                cmp #50
                bcc ph_timedone
                sbc #50
                inc ti_seconds
                ldx ti_seconds
                cpx #60
                bcc ph_timedone
                ldx #$00
                stx ti_seconds
                inc ti_minutes
                ldx ti_minutes
                cpx #60
                bcc ph_timedone
                ldx #$00
                stx ti_minutes
                inc ti_hours
ph_timedone:    sta ti_frame
                rts

bigexplmod:     ldx #$00
                jsr random                      ;X-mod
                asl                             ;Left or right?
                and bigexplradius
                bcc bem_nonegate
                jsr negate
                beq bem_nonegate
                ldx #$ff
bem_nonegate:   sta temp1
                stx temp2
                rts

;-------------------------------------------------------------------------------
; SPAWNACTOR
;
; Creates an actor with the same location & direction as the host actor.
;
; Parameters: A:Actor type to be spawned
;             X:Host actor
;             Y:Free actor number
; Returns: -
; Modifies: A
;-------------------------------------------------------------------------------

spawnactor:     sta actt,y
                lda actd,x
                sta actd,y
                txa
                sta actorg,y
copycoords:     lda actxl,x
                sta actxl,y
                lda actxh,x
                sta actxh,y
                lda actyl,x
                sta actyl,y
                lda actyh,x
                sta actyh,y
                rts

storelastgroundy:
                lda actyl,x
                sta actlastgroundyl,x
                lda actyh,x
                sta actlastgroundyh,x
                rts

;-------------------------------------------------------------------------------
; GETFREEACTOR
;
; Searches for a free actor in the actor table.
; When a free actor is found, some things are resetted here
; (like actor bits)
;
; Parameters: A:Last actor to be checked
;             Y:First actor to be checked
; Returns: C=1 Found (Y:Index) C=0 Not found
; Modifies: A,X,Y
;-------------------------------------------------------------------------------

getfreeactor:   sta maptemp1
gfa_loop:       lda actt,y
                beq gfa_found
gfa_cmp:        cpy maptemp1
                iny
                bcc gfa_loop
                clc
                rts
gfa_found:      sta actf1,y                     ;Can't reset frame2 because not
                sta actfd,y                     ;all actors have it
                sta actsx,y
                sta actsy,y
                sta actsizex,y                  ;Reset collision
                sta actsizeup,y
                sta actsizedown,y
                sta actbits,y
                sta actfls,y
                sta actgrp,y                    ;Bystander group: inactive
                cpy #ACTI_LASTLEVELDATA+1
                bcs gfa_nolevelinit
                sta actpurgeable,y              ;By default not purgeable
                lda lvlactptrlo                 ;Leveldata ptr for possible
                sta actlvlptrlo,y               ;removal
                lda lvlactptrhi
                sta actlvlptrhi,y
gfa_nolevelinit:sec
                rts

;-------------------------------------------------------------------------------
; CREATEACTOR
; INITBASICACTOR
; INITCOMPLEXACTOR
;
; CREATEACTOR sets actor type & goes to INITBASICACTOR.
; INITBASICACTOR resets some values common to all actors.
; INITCOMPLEXACTOR resets the actor's AI and initializes hitpoints + armor.
; Note: actor pos & type must have been set for INITCOMPLEXACTOR.
;
; Parameters: Y:Actor number
;           X:Actor number (INITCOMPLEXACTOR)
;           A:Actor type (CREATEACTOR)
; Returns: -
; Modifies: A,Y,temp1,temp2,actptr
;-------------------------------------------------------------------------------

createactor:    sta actt,y
                lda #$80
                sta actxl,y
                lda #$00
                sta actyl,y

initbasicactor: lda #$00
                beq gfa_found

initcomplexactor:
                lda #WF_NONE
                sta actwf,x
                lda #$00
                sta actwpn,x
initcomplexactor_noweap:
                jsr getactptr
                ldy #AD_DEFAULTHP
                lda (actlptrlo),y
                sta acthp,x
                ldy #AD_DEFAULTBATT
                lda (actlptrlo),y
                sta actbatt,x
                ldy #AD_DEFAULTGROUP
                lda (actlptrlo),y
                sta actgrp,x
                lda #$ff
                sta actlastdmgact2,x
                sta actlastdmgact,x
                sta actlastladderxh,x
                jsr storelastgroundy
                lda #$00
                sta actmode,x           ;Default mode: idle, horizontal,
                sta acthomemode,x       ;player as target
                sta acttarget,x
                sta actf2,x
                sta actctrl,x
                sta actprevctrl,x
                sta actmovectrl,x
                sta acthpdelta,x
                sta acthptime,x
                sta actattkd,x
                sta actattklen,x
                sta acttime,x
                sta actreload,x
                sta actsx,x
                sta actsy,x
                rts


;-------------------------------------------------------------------------------
; NOINTERPOLATION
;
; Disables interpolation of movement for this frame. Good for example in
; climbing motion. To be called after movement.
;
; Parameters: X:Actor num
; Returns: -
; Modifies: A
;-------------------------------------------------------------------------------

nointerpolation:
                lda actxl,x
                and #$f0
                sta actprevxl,x
                lda actxh,x
                sta actprevxh,x
                lda actyl,x
                sta actprevyl,x
                lda actyh,x
                sta actprevyh,x
                rts

;-------------------------------------------------------------------------------
; GETACTPTR
;
; Gets actor logic structure pointer
;
; Parameters: X:Actor num
; Returns: -
; Modifies: A,Y
;-------------------------------------------------------------------------------

getactptr:      lda actt,x
getactlptrdirect:
                asl
                tay
                lda actltbl-2,y                         ;Get logic structure
                sta actlptrlo
                lda actltbl-1,y
                sta actlptrhi
                rts
